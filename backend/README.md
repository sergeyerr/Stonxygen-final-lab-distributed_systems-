# Бэкенд
Бэкенд представляет собой веб-сервер, написанный на Ruby с использованием
библиотеки Sinatra. Он предоставляет REST API, который используется фронтендом.
Сервер предполагается запускать в многопоточном режиме, в коде, обрабатывающем
запросы многопоточность не используется.

## Взаимодействие со Stats_Calculator
При поступлении запроса на получение статистики, сервер обращается в
хранилище Redis. В случае если статистика там не обнаруживается, в
очередь `statistic-queue` бэкенд отправляет сериализованное в JSON сообщение
в следующем формате:

```json
{
    "code": "APPL",
    "host": "me", // Адрес бэкенда в сети
    "port": 6666 // Порт, на котором бэкенд ожидает ответ
}
```

После отправки сообщений бэкенд в рамках обработки одного запроса
создает сокет-сервер на указанном в отправленном сообщении порту
и ждёт некоторое количество времени ответ. В случае поступления ненулевого
ответа бэкенд вновь обращается в Redis для получения статистики.
Если ответ не поступил вовремя или в Redis снова не оказалось нужной
статистики в ответ на запрос отправляется ошибка.

## Взаимодействие с Auth
При поступлении запроса на регистрацию или аутентификацию бэкенд использует
gRPC-процедуры, предоставляемые сервисом Auth для обработки поступившего
запроса. В случае возникновения ошибки, она ретранслируется клиенту.

## Взаимодействие с UserService
При поступлении запроса на добавление или удаление акции, а
также запроса на получение всех акций пользователя бэкенд использует
gRPC-процедуры, предоставляемые сервисом UserService, для обработки
поступившего запроса.
Для получения списка всех акций пользователя, бэкенд также обращается
в хранилище Redis, чтобы по кодам, возвращаемым процедурой GetStocks,
найти полную информацию об акциях, приобретённых пользователем.
